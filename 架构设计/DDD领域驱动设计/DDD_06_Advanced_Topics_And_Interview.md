# 第 6 章：DDD 进阶与面试准备

## 6.1 引言
   - 从熟练到精通：深化 DDD 理解
   - 面向资深工程师的 DDD 考查点

## 6.2 深入理解限界上下文的划分艺术
   - **6.2.1 影响上下文划分的因素回顾**
     - 业务能力、通用语言、团队组织、技术异构性、物理部署等。
   - **6.2.2 上下文边界的权衡**
     - 过大或过小的上下文带来的问题。
     - 上下文的演化与重构。
   - **6.2.3 案例分析：复杂场景下的上下文划分策略**

## 6.3 复杂业务场景下的聚合设计
   - **6.3.1 聚合设计原则再强调**
     - 保持小聚合、事务一致性边界、通过ID引用。
   - **6.3.2 处理聚合间的关联和交互**
     - 领域事件的深入应用。
     - Saga 模式在聚合间协作中的应用。
   - **6.3.3 聚合设计的常见陷阱与解决方案**
     - 聚合过大导致性能问题和并发冲突。
     - 聚合过小导致业务逻辑分散，一致性难以保证。
     - 如何平衡？

## 6.4 分布式事务与最终一致性策略
   - **6.4.1 ACID vs BASE 理论**
   - **6.4.2 两阶段提交 (2PC) / 三阶段提交 (3PC)**
     - 优缺点与适用场景（通常不推荐在微服务中广泛使用）。
   - **6.4.3 TCC (Try-Confirm-Cancel)**
     - 补偿性事务模式。
   - **6.4.4 Saga 模式详解**
     - 编排式 (Orchestration-based) Saga
     - 协同式 (Choreography-based) Saga (通过事件驱动)
     - 实现Saga的挑战：补偿逻辑、幂等性、状态管理。
   - **6.4.5 本地消息表 / 发件箱模式 (Outbox Pattern)**
     - 保证事务性消息发送，实现可靠事件投递。
   - **6.4.6 最终一致性的保障与监控**

## 6.5 DDD 对团队文化和沟通的要求
   - **6.5.1 领域专家与开发团队的持续协作**
     - 建立信任，共同演化通用语言。
   - **6.5.2 知识共享与模型驱动设计**
   - **6.5.3 拥抱变化，持续重构**
   - **6.5.4 DDD Coach 的角色 (如果条件允许)**

## 6.6 常见 DDD 面试题与解答思路 (Java 资深工程师级别)
   - **问题1：请用自己的话解释一下什么是领域驱动设计 (DDD)？它试图解决什么问题？**
     - 思路：核心思想（围绕领域模型、通用语言、战略与战术设计）、解决复杂性、业务与技术对齐。
   - **问题2：什么是限界上下文 (Bounded Context)？为什么它很重要？请举例说明。**
     - 思路：模型边界、语言统一、团队自治、集成点。例子可结合电商（订单上下文、商品上下文、用户上下文）。
   - **问题3：什么是通用语言 (Ubiquitous Language)？如何在项目中建立和维护？**
     - 思路：团队共享、消除歧义、体现在代码和文档中、持续演进。
   - **问题4：请解释实体 (Entity) 和值对象 (Value Object) 的区别和联系。分别举例说明。**
     - 思路：标识、可变性、生命周期、比较方式。实体如 User, Order；值对象如 Money, Address。
   - **问题5：什么是聚合 (Aggregate) 和聚合根 (Aggregate Root)？设计聚合时有哪些原则？**
     - 思路：一致性边界、事务单元、单一入口（聚合根）、小聚合、通过ID引用。
   - **问题6：什么时候应该使用领域服务 (Domain Service)？它和应用服务 (Application Service) 有什么区别？**
     - 思路：无状态操作、涉及多个领域对象、不属于特定实体/值对象。应用服务协调，领域服务执行核心业务。
   - **问题7：什么是领域事件 (Domain Event)？它在 DDD 中有什么作用？**
     - 思路：业务发生的事实、解耦、最终一致性、审计、驱动后续流程。
   - **问题8：请解释一下防腐层 (Anticorruption Layer) 的作用和实现方式。**
     - 思路：保护内部模型免受外部系统变化影响、适配和转换。实现：Façade, Adapter。
   - **问题9：CQRS (命令查询职责分离) 是什么？它能解决什么问题？有什么优缺点？**
     - 思路：读写分离、模型优化、性能伸缩。优点；缺点（复杂性、最终一致性）。
   - **问题10：什么是事件溯源 (Event Sourcing)？它和传统的状态存储有什么不同？有什么优缺点？**
     - 思路：存储事件而非状态、可重构状态。优点（审计、历史追溯）；缺点（查询复杂、事件演化）。
   - **问题11：在你的项目中，你是如何划分限界上下文的？主要考虑了哪些因素？**
     - 思路：结合实际项目经验，说明划分依据（业务、语言、团队、技术）。
   - **问题12：如果让你在一个遗留系统中引入 DDD，你会怎么做？**
     - 思路：绞杀者模式、识别核心域、防腐层、逐步重构。
   - **问题13：DDD 中强调的"贫血模型"和"充血模型"是什么意思？DDD 推崇哪一种？为什么？**
     - 思路：贫血（只有数据，无行为），充血（数据和行为封装）。DDD推崇充血模型，实现高内聚。
   - **问题14：你认为在项目中推行 DDD 最大的挑战是什么？如何应对？**
     - 思路：团队思维转变、领域专家配合、初期投入等。应对：培训、小范围试点、持续沟通。

## 6.7 学习资源推荐
   - 《领域驱动设计：软件核心复杂性应对之道》(Eric Evans)
   - 《实现领域驱动设计》(Vaughn Vernon)
   - 《领域驱动设计模式、原理与实践》(Scott Millett, Nick Tune)
   - InfoQ DDD 社区、相关博客和演讲

## 6.8 本章小结与展望 